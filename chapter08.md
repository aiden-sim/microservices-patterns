# 외부 API 패턴

## 8.1 외부 API 설계 이슈
- FTGO 서비스에서 API를 소비하는 네 종류의 클라이언트
  - 브라우저 기반의 일반 소비자 및 음식점 전용 UI, 내부 관리자용 UI가 구현된 웹 애플리케이션
  - 브라우저에서 실행 중인 자바스크립트 애플리케이션
  - 소비자용/배달원용 모바일 앱
  - 서드파티 애플리케이션 

- 클라이언트가 서비스 API를 직접 호출 시, MSA의 단점
  - 서비스 API가 나누어져 있어서 클라이언트가 필요한 데이터를 가져오려면 여러 번 요청해야 함
  - 클라이언트가 서비스 및 API를 알아야 하는 구조라 캡슐화가 되지 않고, 나중에 아키텍처와 API를 바꾸기 어려움 (서버쪽)
  - 클라이언트가 사용하기에 불편하거나 실용적이지 못한 IPC를 서비스에서 사용중인 경우가 있음 

### 8.1.1 API 설계 이슈: FTGO 모바일 클라이언트
- 소비자는 FTGO 모바일 클라이언트에 접속해서 주문하고 이력을 관리

- MSA에서는 주문 데이터가 여러 서비스에 분산되어 있음
  - 주문 서비스 : 기본 주문 정보(주문 내역, 주문 상태 등)
  - 주방 서비스 : 음식점 관점에서 주문 상태 및 픽업 준비를 마칠 예상 시간
  - 배달 서비스 : 주문 배달 상태, 예상 배달 시간, 현재 위치
  - 회계 서비스 : 주문 지불 상태

- 위 방식의 단점은 모바일 클라이언트가 서비스를 직접 호출하는 구조라면, 서비스를 여러 번 호출해서 데이터를 가져와야 됨 (그림 327P)

#### 클라이언트가 요청을 여러 번 전송하기 때문에 UX가 나빠진다
- 인터넷은 LAN보다 대역폭이 훨씬 낮고 지연 시간이 김
- 모바일 개발자가 복잡한 API 조합 코드를 작성할 일이 많아지게 됨
  - 네트워크 요청 횟수가 늘어나 전력 소모도 커짐 (모바일 기기 배터리도 빨리 닳음) 

#### 캡슐화가 되지 않아 프런트엔드 개발자가 백엔드와 맞물려 코드를 변경해야 한다
- 서비스에 관한 지식이 모바일 앱에 포함되어 있으면 서비스 API를 변경하기 아주 곤란해 질 수 있음

#### 클라이언트에 비친화적인 IPC를 사용 중인 클라이언트도 있다
- gRPC, AMQP 같은 메시징 프로토콜은 내부에서는 잘 작동되지만, 모바일 클라이언트가 소비하기 어려운 경우가 많다.
- 방화벽에 친화적이지 않은 프로토콜도 있음

### 8.1.2 API 설계 이슈: 다른 종류의 클라이언트
- 

## 8.2 API 게이트웨이 패턴
- 



## 8.3 API 게이트웨이 구현
- 


## 8.4 마치며
- 
