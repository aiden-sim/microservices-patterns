# 트랜잭션 관리 : 사가
- 마이크로서비스 아키텍처에서도 단일 서비스 내부의 트랜잭션은 ACID가 보장하지만, 여러 서비스의 데이터를 업데이트하는 트랜잭션은 구현하기 까다로움
- 분산 트랜잭션 기법은 요즘 잘 안맞음
- 사가를 써야 하는데 ACD(원자성, 일관성, 지속성)만 지원하고 격리가 안되서 영향을 줄일 수 있는 설계 기법을 적용해야 됨
  - 코레오그래피 : 중앙 제어 장치 없이 참여자가 각자 서로 이벤트를 교환하는 방법
  - 오케ㅡ트레이션 : 중앙 제어 장치가 참여자가 할 일을 지시하는 방법

## 4.1 마이크로서비스 아키텍처에서의 트랜잭션 관리
- 스프링은 @Transactional만 붙이면 개발자가 간편하게 트랜잭셔널 비즈니스 로직 작성 가능
- 단일 DB를 접근하는 모놀리식 애플리케이션의 트랜잭션 관리는 어렵지 않지만 다중 DB 사용하는 모놀리식이나 MSA는 트랜잭션 관리가 어려움

### 4.1.1 분산 트랜잭션의 필요성
- <img width="638" alt="스크린샷 2022-05-01 오후 2 22 29" src="https://user-images.githubusercontent.com/7076334/166133415-20017fcc-6a58-44e3-b270-35998f4676ad.png"> 
  - 소비자 : 주문 가능한 소비자인지 확인
  - 주방 서비스 : 주문 내역 확인
  - 회계 서비스 : 신용 카드 승인
  - 주문 : 정상적인 경우 주문 생성
    - MSA에서는 일관성을 유지할 수 있는 수단을 강구해야 됨 

### 4.1.2 분산 트랜잭션(2PC)의 문제점
- 스프링에서는 ChainedTransactionManager, JtaTransactionManager 제공


### 4.1.3 데이터 일관성 유지 : 사가 패턴

## 4.2 사가 편성

## 4.3 비격리 문제 처리

## 4.4 주문 서비스 및 주문 생성 사가 설계


## 참고
- https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/

- https://supawer0728.github.io/2018/03/22/spring-multi-transaction/
