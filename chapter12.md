# 마이크로서비스 배포
- 배포는 소프트웨어를 운영에 반영하기 위해 사람(개발자/운영자/기획)이 해야 하는 단계

- 운영 환경의 4대 필수 기능
  - 서비스 관리 인터페이스 : 개발자가 서비스를 생성, 수정, 구성 할 수 있는 인터페이스 제공.
  - 런타임 서비스 관리 : 서비스 인스턴스가 항상 적정한 개수만큼 실행되도록 함. 서비스 인스턴스가 깨질 때, 재시동
  - 모니터링 : 서비스가 무슨 일을 하고 있는지, 로그 파일 및 지표를 개발자가 관찰할 수 있게 함. 운영환경에 문제가 있으면 개발자가 알아야 함 (알람)
  - 요청 라우팅 : 사용자 요청을 서비스로 보냄

- 네 가지 주요 배포 옵션
  - 언어에 특정한 패키지(JAR/WAR)로 서비스를 배포 : 단점이 많지만, 다른 옵션을 권장하는 이유라서 같이 살펴범
  - 서비스를 가상 머신으로 배포 : 서비스를 가상 머신 이미지로 묶어 배포 하는 방식. 서비스의 기술 스택을 캡슐화
  - 서비스를 컨테이너로 배포 : 컨테이너는 가상 머신보다 가벼움. (쿠버네티스)
  - 서비스를 서버리스 배포 기술로 배포 : 컨테이너보다 더 최근에 나온 기술. (AWS 람다) 


## 12.1 서비스 배포: 언어에 특정한 패키징 포캣 패턴
- 사전 필요
  - 필요한 런타임(JDK) 설치
  - WAR 파일 배포 시, 웹 컨테이너(톰캣) 설치
  - 자동 배포를 위한 파이프라인 구축

- 머신 하나에 여러 JVM 띄워서, JVM 당 하나의 서비스 인스턴스 가동
- 하나의 JVM에 여러 서비스 인스턴스 실행도 가능 (격리 안됨)

### 12.1.1 언어에 특정한 패키징 포맷 패턴의 장점
- 장점
  - 배포가 빠름
  - 리소스를 효율적으로 활용할 수 있음(같은 머신이나, 프로세스 내에 여러 인스턴스 실행) 

#### 배포가 빠르다
- 서비스를 복사해서 그냥 시동하면 되기 때문에 속도가 가장 빠름
- 오버헤드가 없어서 서비스도 빨리 시동되는 편

#### 리소스를 효율적으로 활용할 수 있다
- 여러 서비스 인스턴스가 머신과 OS를 공유하므로 리소스를 효율적으로 활용할 수 있음 (장점이자 단점)

### 12.1.2 언어에 특정한 패키징 포맷 패턴의 단점
- 단점
  - 기술 스택을 캡슐화할 수 없음
  - 서비스 인스턴스가 소비하는 리소스를 제한할 수 없음
  - 여러 서비스 인스턴스가 동일 머신에서 실행될 경우 서로 격리할 수 없음
  - 서비스 인스턴스를 어디에 둘지 자동으로 결정하기 어려움 

#### 기술 스택을 캡슐화할 수 없다
- 서비스별로 런타임 버전이 젖ㅇ해져 있고, 필요한 소프트웨어 패키지 버전이 상이할 수 있으므로 정확하게 구분해야 함
- 서비스마다 사용한 언어/프레임워크가 다양할 수 있고, 같은 언어/프레임워크라도 버전이 제각각일 수 있으니 많은 세부 정보를 운영팀과 공유

#### 서비스 인스턴스가 소비하는 리소스를 제한할 방법이 없다
- 인스턴스가 소비하는 리소스를 제한할 방법이 없음
  - 한 프로세스가 전체 CPU/메모리를 다 소모하면, 다른 서비스 인스턴스에게 영향을 줌 

#### 여러 서비스 인스턴스가 동일 머신에서 실행될 경우 서로 격리할 수 없다
- 하나의 인스턴스가 오작동하면 다른 인스턴스에도 영향을 기칠 수 있음

#### 서비스 인스턴스를 어디에 둘지 자동으로 결정하기 어렵다
- CPU, 메모리 같은 리소스는 한정되어 있고 각 서비스 인스턴스는 일정량의 리소스가 필요하기 때문에 너무 지나치지 않게, 머신을 최대한 효율적으로 활용하는 방향으로 서비스 인스턴스를 배정

## 12.2 서비스 배포: 가상 머신 패턴



## 12.3 서비스 배포: 컨테이너 패턴

## 12.4 FTGO 애플리케이션 배포: 쿠버네티스

## 12.5 서비스 배포: 서버리스 패턴


## 12.6 REST 서비스 배포: AWS 람다 및 AWS 게이트웨이







